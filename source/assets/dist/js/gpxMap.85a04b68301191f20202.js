!function(){"use strict";var t=document.getElementById("gpx-map");if(t){var e=t.dataset.track;if(e){var a=L.map("gpx-map",{scrollWheelZoom:!1});L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:17,attribution:'Map data: &copy; <a href="https://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'}).addTo(a);var n=[],o=[],r=0,i=null,l=null,d=null,s=document.getElementById("gpx-distance-slider"),c=document.getElementById("distance-current"),p=document.getElementById("distance-total"),g=document.getElementById("gpx-animate-btn"),h=null,u=!1,m=L.divIcon({className:"gpx-marker-start",html:'<div style="background:#19a974;width:14px;height:14px;border-radius:50%;border:2px solid white;box-shadow:0 2px 4px rgba(0,0,0,0.3);"></div>',iconSize:[14,14],iconAnchor:[7,7]}),f=L.divIcon({className:"gpx-marker-end",html:'<div style="background:#e7040f;width:14px;height:14px;border-radius:50%;border:2px solid white;box-shadow:0 2px 4px rgba(0,0,0,0.3);"></div>',iconSize:[14,14],iconAnchor:[7,7]});new L.GPX(e,{async:!0,marker_options:{startIconUrl:"",endIconUrl:"",shadowUrl:""}}).on("loaded",(function(t){if(t.target.getLayers().forEach((function(t){t.getLatLngs&&M(t.getLatLngs(),n)})),0!==n.length){var e=function(t){for(var e,a,n,o,r,i,l,d,s,c=[0],p=0,g=1;g<t.length;g++)p+=(e=t[g-1].lat,a=t[g-1].lng,n=t[g].lat,o=t[g].lng,r=void 0,i=void 0,l=void 0,d=void 0,s=void 0,r=e*Math.PI/180,i=n*Math.PI/180,l=(n-e)*Math.PI/180,d=(o-a)*Math.PI/180,s=Math.sin(l/2)*Math.sin(l/2)+Math.cos(r)*Math.cos(i)*Math.sin(d/2)*Math.sin(d/2),2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371e3),c.push(p);return{distances:c,total:p}}(n);o=e.distances;var h=((r=e.total)/1e3).toFixed(1);p.textContent=h+" km",i=L.polyline(n,{color:"#666666",weight:4,opacity:.3}).addTo(a),l=L.polyline(n,{color:"#e7040f",weight:4,opacity:.9}).addTo(a),L.marker([n[0].lat,n[0].lng],{icon:m}).addTo(a);var u=n[n.length-1];d=L.marker([u.lat,u.lng],{icon:f}).addTo(a),a.fitBounds(i.getBounds(),{padding:[30,30]}),s.value=100,c.textContent=h+" km",s.disabled=!1,g.disabled=!1,s.addEventListener("input",x),g.addEventListener("click",y)}else console.error("GPX map: No track coordinates found")})).on("error",(function(t){console.error("GPX map: Failed to load GPX file",t)}))}else console.error("GPX map: No track URL specified in data-track attribute")}function v(t){var e=function(t){if(n.length<2)return n;if(t<=0)return[n[0],n[0]];if(t>=r)return n;for(var e=[],a=0;a<o.length;a++){if(!(o[a]<=t)){var i=o[a-1],l=(t-i)/(o[a]-i),d=n[a-1],s=n[a];e.push({lat:d.lat+(s.lat-d.lat)*l,lng:d.lng+(s.lng-d.lng)*l});break}e.push(n[a])}return e}(t);if(l&&l.setLatLngs(e),d&&e.length>0){var a=e[e.length-1];d.setLatLng([a.lat,a.lng])}var i=(t/1e3).toFixed(1);c.textContent=i+" km"}function x(){v(parseFloat(s.value)/100*r)}function y(){if(u)b();else{u=!0,g.textContent="Stop";var t=performance.now();s.value=0,v(0),h=requestAnimationFrame((function e(a){var n=a-t,o=Math.min(n/15e3,1),i=0+100*(o<.5?2*o*o:1-Math.pow(-2*o+2,2)/2);s.value=i,v(i/100*r),o<1?h=requestAnimationFrame(e):b()}))}}function b(){h&&(cancelAnimationFrame(h),h=null),u=!1,g.textContent="Animate Track"}function M(t,e){if(Array.isArray(t))for(var a=0;a<t.length;a++){var n=t[a];n&&"number"==typeof n.lat&&"number"==typeof n.lng?e.push({lat:n.lat,lng:n.lng}):Array.isArray(n)&&M(n,e)}}}();